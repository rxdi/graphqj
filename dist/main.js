#!/usr/bin/env node
parcelRequire=function(e,r,t,n){var i,o="function"==typeof parcelRequire&&parcelRequire,u="function"==typeof require&&require;function f(t,n){if(!r[t]){if(!e[t]){var i="function"==typeof parcelRequire&&parcelRequire;if(!n&&i)return i(t,!0);if(o)return o(t,!0);if(u&&"string"==typeof t)return u(t);var c=new Error("Cannot find module '"+t+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(r){return e[t][1][r]||r},p.cache={};var l=r[t]=new f.Module(t);e[t][0].call(l.exports,p,l,l.exports,this)}return r[t].exports;function p(e){return f(p.resolve(e))}}f.isParcelRequire=!0,f.Module=function(e){this.id=e,this.bundle=f,this.exports={}},f.modules=e,f.cache=r,f.parent=o,f.register=function(r,t){e[r]=[function(e,r){r.exports=t},{}]};for(var c=0;c<t.length;c++)try{f(t[c])}catch(e){i||(i=e)}if(t.length){var l=f(t[t.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=l:"function"==typeof define&&define.amd?define(function(){return l}):n&&(this[n]=l)}if(parcelRequire=f,i)throw i;return f}({"helpers/args-extractors.ts":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.includes=(e=>process.argv.toString().includes(e)),exports.nextOrDefault=((e,r=!0,s=(e=>e))=>{if(process.argv.toString().includes(e)){const t=process.argv[process.argv.indexOf(e)+1];return t?t.includes("--")?r:s(t):r}return r});
},{}],"helpers/typescript.builder.ts":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const e=require("child_process");exports.TranspileTypescript=((r,s)=>new Promise((o,t)=>{const p=e.spawn("npx",["gapi","build","--glob",`${r.toString()}`,"--outDir",s]);p.stderr.pipe(process.stderr),p.on("close",e=>o(e))}));
},{}],"helpers/set-config.ts":[function(require,module,exports) {
"use strict";var i=this&&this.__awaiter||function(i,e,t,n){return new(t||(t=Promise))(function(r,o){function s(i){try{u(n.next(i))}catch(e){o(e)}}function c(i){try{u(n.throw(i))}catch(e){o(e)}}function u(i){i.done?r(i.value):new t(function(e){e(i.value)}).then(s,c)}u((n=n.apply(i,e||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0});const e=require("util"),t=require("fs"),n=require("./typescript.builder"),r=require("path"),o=require("js-yaml");function s(s){return i(this,void 0,void 0,function*(){let c;try{c=require("esm")(module)(r.join(process.cwd(),`${s}.js`))}catch(u){}if(yield e.promisify(t.exists)(`./${s}.yml`)){const i=t.readFileSync(`./${s}.yml`,{encoding:"utf-8"});c=o.load(i)}if(yield e.promisify(t.exists)(`./${s}.ts`)){const o=yield e.promisify(t.exists)("./.gj/config.temp"),y=r=>i(this,void 0,void 0,function*(){yield n.TranspileTypescript([`/${s}.ts`],"./.gj"),yield e.promisify(t.writeFile)("./.gj/config.temp",r.mtime.toISOString(),{encoding:"utf-8"})}),d=yield e.promisify(t.stat)(`./${s}.ts`);if(o){const i=yield e.promisify(t.readFile)("./.gj/config.temp",{encoding:"utf-8"});new Date(i).toISOString()!==d.mtime.toISOString()&&(yield y(d))}else yield y(d);c=require(r.join(process.cwd(),"./.gj",`${s}.js`));try{yield e.promisify(t.unlink)(r.join("./.gj",`${s}.js.map`))}catch(u){}}try{c=JSON.parse(yield e.promisify(t.readFile)(r.join(process.cwd(),`${s}.json`),{encoding:"utf-8"}))}catch(u){}return c})}exports.getConfig=s;
},{"./typescript.builder":"helpers/typescript.builder.ts"}],"helpers/basic.template.ts":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.basicTemplate={$mode:"basic",$types:{user:{pesho:"string"}},$schema:"./schema.graphql",$resolvers:{findUser:{gosho:"omg",pesho:515151,pesho2:515151,pesho3:515151,dadadada:515151,pesho4:515151,pesho5:[515151],pesho6:["515151"]},findUser2:{gosho:"omg",pesho:22,pesho2:515151,pesho3:515151,pesho4:515151,pesho5:515151}}};
},{}],"app/app.tokens.ts":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const e=require("@rxdi/core");function n(e){return e.reduce((e,n)=>(e[n]=n,e),Object.create(null))}exports.BooleanUnion=n(["Boolean","Bool","boolean","Boolean[]","boolean[]","[Boolean]","[Bool]","boolean!","Boolean!","[Boolean]!","boolean[]!","Boolean[]!"]),exports.StringUnion=n(["String","string","String[]","string[]","[String]","string!","String!","String[]!","string[]!","[String]!"]),exports.IntegerUnion=n(["Int","integer","number","Number","Num","int","Number[]","number[]","[Number]","number!","[Int]","Number!","number[]!","Number[]!","[Number]!","[Int]!"]),exports.Roots={booleanNode:exports.BooleanUnion,stringNode:exports.StringUnion,numberNode:exports.IntegerUnion},exports.TypesToken=new e.InjectionToken("(@rxdi/graphqj): types-token"),exports.ArgumentsToken=new e.InjectionToken("(@rxdi/graphqj): arguments-token"),exports.ResolversToken=new e.InjectionToken("(@rxdi/graphqj): resolvers-token"),exports.GuardsToken=new e.InjectionToken("(@rxdi/graphqj): resolvers-token"),exports.Config=new e.InjectionToken;
},{}],"helpers/parse-ast.ts":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const e=require("graphql");function n(n){let r;return"string"!==n&&"String"!==n||(r={type:e.GraphQLString}),"boolean"!==n&&"Boolean"!==n&&"Bool"!==n||(r={type:e.GraphQLBoolean}),"number"!==n&&"Number"!==n&&"Int"!==n||(r={type:e.GraphQLInt}),"string!"!==n&&"String!"!==n||(r={type:new e.GraphQLNonNull(e.GraphQLString)}),"boolean!"!==n&&"Boolean!"!==n||(r={type:new e.GraphQLNonNull(e.GraphQLBoolean)}),"number!"!==n&&"Number!"!==n&&"Int"!==n||(r={type:new e.GraphQLNonNull(e.GraphQLInt)}),"string[]"!==n&&"String[]"!==n&&"[String]"!==n||(r={type:new e.GraphQLList(e.GraphQLString)}),"boolean[]"!==n&&"Boolean[]"!==n&&"[Boolean]"!==n&&"[Bool]"!==n||(r={type:new e.GraphQLList(e.GraphQLBoolean)}),"number[]"!==n&&"Number[]"!==n&&"[Number]"!==n&&"[Int]"!==n||(r={type:new e.GraphQLList(e.GraphQLInt)}),"string[]!"!==n&&"String[]!"!==n&&"[String]!"!==n||(r={type:new e.GraphQLNonNull(new e.GraphQLList(e.GraphQLString))}),"boolean[]!"!==n&&"Boolean[]!"!==n&&"[Boolean]!"!==n&&"[Bool]"!==n||(r={type:new e.GraphQLNonNull(new e.GraphQLList(e.GraphQLBoolean))}),"number[]!"!==n&&"Number[]!"!==n&&"[Number]!"!==n&&"[Int]!"!==n||(r={type:new e.GraphQLNonNull(new e.GraphQLList(e.GraphQLInt))}),r}exports.ParseArgs=n;
},{}],"helpers/dynamic-schema/mutators/build-arguments.ts":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const e=require("../../../app/app.tokens"),r=require("../../parse-ast"),s=require("@rxdi/core");function t(t){Object.keys(t.$args).forEach(o=>{const a={};Object.keys(t.$args[o]).forEach(c=>{a[c]=r.ParseArgs(t.$args[o][c]),s.Container.get(e.TypesToken).set(o,a)})})}exports.buildArguments=t;
},{"../../../app/app.tokens":"app/app.tokens.ts","../../parse-ast":"helpers/parse-ast.ts"}],"helpers/lazy-types.ts":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.lazyTypes=new Map;
},{}],"helpers/parse-types.schema.ts":[function(require,module,exports) {
"use strict";var e=this&&this.__awaiter||function(e,r,t,n){return new(t||(t=Promise))(function(i,o){function a(e){try{s(n.next(e))}catch(r){o(r)}}function p(e){try{s(n.throw(e))}catch(r){o(r)}}function s(e){e.done?i(e.value):new t(function(r){r(e.value)}).then(a,p)}s((n=n.apply(e,r||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0});const r=require("graphql"),t=require("@rxdi/core"),n=require("rxjs"),i=require("./lazy-types");function o(o,a,p,s,u){let c;"string"!==o&&"String"!==o||(c={type:r.GraphQLString}),"boolean"!==o&&"Boolean"!==o||(c={type:r.GraphQLString}),"number"!==o&&"Number"!==o||(c={type:r.GraphQLInt}),"string[]"!==o&&"String[]"!==o&&"[String]"!==o||(c={type:new r.GraphQLList(r.GraphQLString)}),"boolean[]"!==o&&"Boolean[]"!==o&&"[Boolean]"!==o||(c={type:new r.GraphQLList(r.GraphQLString)}),"number[]"!==o&&"Number[]"!==o&&"[Number]"!==o||(c={type:new r.GraphQLList(r.GraphQLInt)});const l=o.replace("(","").replace(")","").replace("!","").replace("[","").replace("]","");if(p===l&&(i.lazyTypes.set(p,Object.assign({},i.lazyTypes.get(p),{[a]:l})),c={type:u[p]}),!c)throw new Error(`Wrong plugged type ${o}`);return c.resolve=function(...r){return e(this,void 0,void 0,function*(){let e=r[0][a];for(const i of s)e=yield t.Container.get(i)(n.of(e),r[0],r[1],r[2],r[3]),n.isObservable(e)&&(e=yield e.toPromise());return e})},c}exports.ParseTypesSchema=o;
},{"./lazy-types":"helpers/lazy-types.ts"}],"helpers/dynamic-schema/mutators/build-types.ts":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const e=require("../../../app/app.tokens"),t=require("../../parse-types.schema"),n=require("@rxdi/core"),r=require("graphql");function o(e,t,n){let r="(",o=")";t.includes("{")&&(r="{",o="}");const i=t.split(r);let c;if(t.includes("@"))c=i[1].replace(o,"").split("@");else{const e=i[1].replace(o,"").split(n);for(var l=e.length;l-- >1;)e.splice(l,0,n);c=e}const p=(c=c.filter(e=>!!e))[0],a=c[1].replace(/ +?/g,""),{token:u,interceptor:f}=s(p,a,e);return{token:u,interceptor:f}}function s(e,t,r){const o=c(e,t,r);return{token:new n.InjectionToken(n.createUniqueHash(`${o}`)),interceptor:o}}function i(e=[],t){return e.map(e=>{const[r]=t.filter(t=>t.includes(e.map));if(r){const t=r.replace(/[^\w\s]/gi,"").replace(/ +?/g,""),o=e.module[t];if(!o)throw new Error(`Missing method ${t} inside ${e.file}`);return{symbol:e.map,token:new n.InjectionToken(n.createUniqueHash(`${o}`)),module:e.module,method:o,injector:t}}}).filter(e=>!!e)}function c(e,t,n){const r=n.find(t=>t.map===e);if(!r.module[t])throw new Error(`Missing method ${t} inside ${r.file}`);return r.module[t]}function l(s,c,l){Object.keys(s.$types).forEach(p=>{if(c[p])return;const a=s.$types[p];Object.keys(a).forEach(r=>{c[p]=c[p]||{};let l=a[r];const u=[];if(s.$externals){const[t]=s.$externals.map(e=>e.map).filter(e=>l.includes(e));if(t){const r=[...new Set(l.split("=>").map(e=>e.replace(/ +?/g,"").trim()))];if(r.length>2){const e=r.slice(1,r.length);for(const t of i(s.$externals,e))n.Container.set(t.token,t.method),u.push(t.token)}else{const{token:e,interceptor:r}=o(s.$externals,l,t);n.Container.set(e,r),u.push(e)}l=Object.keys(e.Roots).map(t=>{const n=Object.keys(e.Roots[t]).filter(e=>l.includes(e));if(n.length)return n[0]}).filter(e=>!!e)[0]}}c[p][r]=t.ParseTypesSchema(l,r,p,u,c)}),l[p]=new r.GraphQLObjectType({name:p,fields:()=>c[p]})})}exports.buildTypes=l;
},{"../../../app/app.tokens":"app/app.tokens.ts","../../parse-types.schema":"helpers/parse-types.schema.ts"}],"helpers/isFunction.ts":[function(require,module,exports) {
"use strict";function e(e){return"function"==typeof e}Object.defineProperty(exports,"__esModule",{value:!0}),exports.isFunction=e;
},{}],"helpers/get-first-item.ts":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const e=require("./isFunction");function r(r){if(!r)return null;let t;for(var i in r){t=i;break}if(!r[t])throw new Error(`Missing method ${t}`);return e.isFunction(r[t])&&(r=r[t]),r}exports.getFirstItem=r;
},{"./isFunction":"helpers/isFunction.ts"}],"helpers/parse-args-schema.ts":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const e=require("graphql"),r=require("@rxdi/core"),t=require("./parse-ast"),s=require("../app/app.tokens"),a=new Map;exports.buildArgumentsSchema=((p,n)=>{let o=p.$resolvers[n].args||{},l={};const u=r.Container.get(s.TypesToken);return Object.keys(o).forEach(r=>{const s=o[r].replace("!","");if(u.has(s)){let t=new e.GraphQLInputObjectType({name:s,fields:()=>u.get(s)});return a.has(s)&&(t=a.get(s)),a.set(s,t),void(l=o[r].includes("!")?{payload:{type:new e.GraphQLNonNull(t)}}:{payload:{type:t}})}l[r]=t.ParseArgs(o[r])}),l});
},{"./parse-ast":"helpers/parse-ast.ts","../app/app.tokens":"app/app.tokens.ts"}],"helpers/dynamic-schema/mutators/build-resolvers.ts":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const e=require("../../isFunction"),r=require("../../lazy-types"),t=require("../../get-first-item"),s=require("../../parse-args-schema"),o=require("@rxdi/core"),i=require("@gapi/core");function a(a,c,n){Object.keys(a.$resolvers).forEach(l=>{const p=a.$resolvers[l].type,y=(a.$resolvers[l].method||"query").toLocaleLowerCase();let u=a.$resolvers[l].deps||[];if(!n[p])throw new Error(`Missing type '${p}', Available types: '${Object.keys(c).toString()}'`);let d=a.$resolvers[l].resolve;!d||e.isFunction(d)||Array.isArray(d)||(d=t.getFirstItem(d));const g=d;d=e.isFunction(d)?d:()=>g,Array.from(r.lazyTypes.keys()).forEach(e=>{Object.keys(r.lazyTypes.get(e)).forEach(r=>{n[e].getFields()[r].type=n[e]})}),o.Container.get(i.BootstrapService).Fields[y][l]={type:n[p],method_name:l,args:s.buildArgumentsSchema(a,l),public:!0,method_type:y,target:(e=>e.map(({provide:e,map:r})=>({container:o.Container.get(e),provide:e,map:r})).reduce((e,r)=>Object.assign({},e,{[r.map]:r.container}),{}))(u),resolve:d}})}exports.buildResolvers=a;
},{"../../isFunction":"helpers/isFunction.ts","../../lazy-types":"helpers/lazy-types.ts","../../get-first-item":"helpers/get-first-item.ts","../../parse-args-schema":"helpers/parse-args-schema.ts"}],"helpers/advanced-schema.ts":[function(require,module,exports) {
"use strict";var e=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(s,u){function i(e){try{c(n.next(e))}catch(t){u(t)}}function a(e){try{c(n.throw(e))}catch(t){u(t)}}function c(e){e.done?s(e.value):new r(function(t){t(e.value)}).then(i,a)}c((n=n.apply(e,t||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0});const t=require("../helpers/dynamic-schema/mutators/build-arguments"),r=require("../helpers/dynamic-schema/mutators/build-types"),n=require("../helpers/dynamic-schema/mutators/build-resolvers");function s(s){return e(this,void 0,void 0,function*(){const e={},u={};return s.$args=s.$args||{},t.buildArguments(s),r.buildTypes(s,e,u),n.buildResolvers(s,e,u),u})}exports.MakeAdvancedSchema=s;
},{"../helpers/dynamic-schema/mutators/build-arguments":"helpers/dynamic-schema/mutators/build-arguments.ts","../helpers/dynamic-schema/mutators/build-types":"helpers/dynamic-schema/mutators/build-types.ts","../helpers/dynamic-schema/mutators/build-resolvers":"helpers/dynamic-schema/mutators/build-resolvers.ts"}],"helpers/basic-schema.ts":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const e=require("graphql");function t(t,r){Object.keys(t.$resolvers).forEach(p=>{const o=t.$resolvers[p],n={};Object.keys(o).forEach(t=>{const r=o[t];"string"==typeof r&&(n[t]={type:e.GraphQLString}),"number"==typeof r&&(n[t]={type:e.GraphQLInt}),"boolean"==typeof r&&(n[t]={type:e.GraphQLBoolean}),"string"!=typeof r&&r.length&&("string"==typeof r[0]&&(n[t]={type:new e.GraphQLList(e.GraphQLString)}),"number"==typeof r[0]&&(n[t]={type:new e.GraphQLList(e.GraphQLInt)}),"boolean"==typeof r[0]&&(n[t]={type:new e.GraphQLList(e.GraphQLBoolean)}))}),r.Fields.query[p]={type:new e.GraphQLObjectType({name:`${p}_type`,fields:()=>n}),args:{},method_name:p,public:!0,method_type:"query",target:()=>{},resolve:"function"==typeof o?o:()=>o}})}exports.MakeBasicSchema=t;
},{}],"helpers/transpile-and-load.ts":[function(require,module,exports) {
"use strict";var e=this&&this.__awaiter||function(e,r,t,n){return new(t||(t=Promise))(function(i,s){function c(e){try{u(n.next(e))}catch(r){s(r)}}function o(e){try{u(n.throw(e))}catch(r){s(r)}}function u(e){e.done?i(e.value):new t(function(r){r(e.value)}).then(c,o)}u((n=n.apply(e,r||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0});const r=require("./typescript.builder"),t=require("path"),n=require("clear-module");function i(t,i){return e(this,void 0,void 0,function*(){t=c(t),yield r.TranspileTypescript([t],i),Object.keys(require.cache).forEach(function(e){delete require.cache[e]});const e=s(t,i);return n(e),require(e)})}function s(e,r){return t.join(process.cwd(),r,t.parse(t.join(process.cwd(),r,e)).base.replace("ts","js"))}function c(e){return e="."===e[0]?e.substr(1):e,t.isAbsolute(e)?e=e.replace(process.cwd(),""):e}function o(n,i){return e(this,void 0,void 0,function*(){return yield r.TranspileTypescript(n.map(e=>e.file).map(e=>c(e)),i),n.map(e=>Object.assign({},e,{transpiledFile:t.join(process.cwd(),i,t.parse(e.file).base.replace("ts","js"))}))})}exports.TranspileAndLoad=i,exports.TranspileAndGetAll=o;
},{"./typescript.builder":"helpers/typescript.builder.ts"}],"helpers/is-invalid-path.ts":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const e=require("path");function t(t,r={}){if(""===t||"string"!=typeof t)return!0;const n=r.extended?32767:260;if("string"!=typeof t||t.length>n-12)return!0;const s=e.parse(t).root;return s&&(t=t.slice(s.length)),r.file?/[<>:"\/\\|?*]/.test(t):/[<>:"|?*]/.test(t)}exports.isInValidPath=t;
},{}],"helpers/traverse-map.ts":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.traverseMap=[];
},{}],"helpers/load-yml.ts":[function(require,module,exports) {
"use strict";var e=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,o){function u(e){try{a(i.next(e))}catch(t){o(t)}}function c(e){try{a(i.throw(e))}catch(t){o(t)}}function a(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(u,c)}a((i=i.apply(e,t||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0});const t=require("util"),n=require("js-yaml"),i=require("fs");function r(r){return e(this,void 0,void 0,function*(){return n.load(yield t.promisify(i.readFile)(r,{encoding:"utf-8"}))})}exports.loadYml=r;
},{}],"helpers/is-runner-installed.ts":[function(require,module,exports) {
"use strict";var t=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))(function(r,o){function u(t){try{s(i.next(t))}catch(e){o(e)}}function c(t){try{s(i.throw(t))}catch(e){o(e)}}function s(t){t.done?r(t.value):new n(function(e){e(t.value)}).then(u,c)}s((i=i.apply(t,e||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0});const e=require("child_process"),n=require("util");function i(i){return t(this,void 0,void 0,function*(){let t;try{t=!(yield n.promisify(e.exec)(i)).stderr}catch(r){t=!1}return t})}function r(){return t(this,void 0,void 0,function*(){return yield i("parcel help")})}function o(){return t(this,void 0,void 0,function*(){return yield i("gapi daemon status")})}exports.isParcelInstalled=r,exports.isGapiInstalled=o;
},{}],"helpers/load-file.ts":[function(require,module,exports) {
"use strict";var e=this&&this.__awaiter||function(e,r,i,t){return new(i||(i=Promise))(function(n,s){function a(e){try{u(t.next(e))}catch(r){s(r)}}function l(e){try{u(t.throw(e))}catch(r){s(r)}}function u(e){e.done?n(e.value):new i(function(r){r(e.value)}).then(a,l)}u((t=t.apply(e,r||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0});const r=require("util"),i=require("./transpile-and-load"),t=require("fs"),n=require("./is-invalid-path"),s=require("./traverse-map"),a=require("path"),l=require("./load-yml"),u=require("./is-runner-installed");function o(o){return e(this,void 0,void 0,function*(){let e;if(n.isInValidPath(o))return o;if(!(yield r.promisify(t.exists)(o))){const e=s.traverseMap[s.traverseMap.length-1];e&&(o=a.join(process.cwd(),e.parent,o.replace(process.cwd(),"")))}e=(yield u.isGapiInstalled())&&(o.includes(".ts")||o.includes(".js"))?yield i.TranspileAndLoad(o,"./.gj/out"):o.includes(".yml")?l.loadYml(o):o.includes(".json")?require(o):o.includes(".html")?yield r.promisify(t.readFile)(o,{encoding:"utf-8"}):require("esm")(module)(o);const d=o.substring(0,o.lastIndexOf("/")).replace(process.cwd(),"");return s.traverseMap.push({parent:d,path:o}),e})}exports.loadFile=o;
},{"./transpile-and-load":"helpers/transpile-and-load.ts","./is-invalid-path":"helpers/is-invalid-path.ts","./traverse-map":"helpers/traverse-map.ts","./load-yml":"helpers/load-yml.ts","./is-runner-installed":"helpers/is-runner-installed.ts"}],"helpers/traverse/test.ts":[function(require,module,exports) {
"use strict";var e=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,o){function u(e){try{l(r.next(e))}catch(t){o(t)}}function c(e){try{l(r.throw(e))}catch(t){o(t)}}function l(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(u,c)}l((r=r.apply(e,t||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0});const t=require("../load-file"),n=require("path");function r(e){return e.replace("💉","")}function i(t){return e(this,void 0,void 0,function*(){return"object"!=typeof t||null===t?t:Array.isArray(t)?u(t):o(t)})}function o(o){return e(this,void 0,void 0,function*(){const e={};let u,c={};for(let[l,s]of Object.entries(o))if("string"==typeof s&&s.includes("💉")){u=`${r(s)}`;const o=yield t.loadFile(n.join(process.cwd(),u));e[l]=yield i(o),c[l]=u,Object.defineProperty(e,"_meta",{value:c,enumerable:!1,writable:!0})}else e[l]=yield i(s);return e})}function u(t){return e(this,void 0,void 0,function*(){return yield Promise.all(t.map(t=>e(this,void 0,void 0,function*(){return i(t)})))})}exports.replaceInjectSymbol=r,exports.deep=i,exports.meta=new Map,exports.deepObject=o,exports.deepArray=u;
},{"../load-file":"helpers/load-file.ts"}],"helpers/is-array.ts":[function(require,module,exports) {
"use strict";function e(e){return"[object Array]"===Object.prototype.toString.call(e)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.isArray=e;
},{}],"helpers/traverse/traverse.ts":[function(require,module,exports) {
"use strict";var t=this&&this.__awaiter||function(t,e,r,n){return new(r||(r=Promise))(function(i,o){function u(t){try{s(n.next(t))}catch(e){o(e)}}function c(t){try{s(n.throw(t))}catch(e){o(e)}}function s(t){t.done?i(t.value):new r(function(e){e(t.value)}).then(u,c)}s((n=n.apply(t,e||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0});const e=require("../is-array");function r(r,o){return t(this,void 0,void 0,function*(){e.isArray(r)?yield i(r,o):"object"==typeof r&&null!==r&&(yield n(r,o))})}function n(e,n){return t(this,void 0,void 0,function*(){for(let[t,i]of Object.entries(e))if(e.hasOwnProperty(t)){if(n(t,i))break;yield r(e[t],n)}})}function i(e,n){return t(this,void 0,void 0,function*(){for(const t of e)return yield r(t,n)})}exports.traverse=r,exports.traverseObject=n,exports.traverseArray=i;
},{"../is-array":"helpers/is-array.ts"}],"helpers/react-to-changes.ts":[function(require,module,exports) {
"use strict";var e=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(i,o){function a(e){try{s(n.next(e))}catch(t){o(t)}}function c(e){try{s(n.throw(e))}catch(t){o(t)}}function s(e){e.done?i(e.value):new r(function(t){t(e.value)}).then(a,c)}s((n=n.apply(e,t||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0});const t=require("./traverse/traverse"),r=require("@gapi/core"),n=require("./get-first-item"),i=require("./load-file"),o=require("./advanced-schema"),a=require("./traverse/test"),c=require("./lazy-types");function s(e,t){return Object.keys(t).find(r=>t[r]===e)}function u(e){return`.${e.replace(process.cwd(),"")}`}let l;function d(d,f){return e(this,void 0,void 0,function*(){if(l)return void console.log(`✋  Bundle is updating previews change! Unable to update ${d}`);const e=Date.now();console.log(`💡  Bundle changed: ${d}`),l=!0;try{const y=yield i.loadFile(d);if(f._meta){const e=s(u(d),f._meta);e?f[e]=yield a.deep(y):yield t.traverse(f,(e,t)=>{if("object"==typeof t&&t._meta){const e=s(u(d),t._meta);if(e)return t[e]=n.getFirstItem(y),!0}return!1})}else f=yield a.deep(y);c.lazyTypes.clear(),r.Container.get(r.BootstrapService).Fields={mutation:{},query:{},subscription:{}},yield o.MakeAdvancedSchema(f),r.Container.get(r.ApolloService).init(),console.log(`📦  Bundle realoaded! ${Date.now()-e}ms`,d),l=!1}catch(p){l=!1,console.error(p)}})}exports.reactToChanges=d;
},{"./traverse/traverse":"helpers/traverse/traverse.ts","./get-first-item":"helpers/get-first-item.ts","./load-file":"helpers/load-file.ts","./advanced-schema":"helpers/advanced-schema.ts","./traverse/test":"helpers/traverse/test.ts","./lazy-types":"helpers/lazy-types.ts"}],"helpers/watch-bundles.ts":[function(require,module,exports) {
"use strict";var e=this&&this.__awaiter||function(e,n,t,o){return new(t||(t=Promise))(function(c,r){function i(e){try{s(o.next(e))}catch(n){r(n)}}function u(e){try{s(o.throw(e))}catch(n){r(n)}}function s(e){e.done?c(e.value):new t(function(n){n(e.value)}).then(i,u)}s((o=o.apply(e,n||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0});const n=require("chokidar"),t=require("./react-to-changes"),o=["./gj.yml","./gj.json","./gj.js","./gj.ts"];function c(c,r){n.watch([...new Set(c),...o],{ignored:e=>e.includes("node_modules")}).on("change",n=>e(this,void 0,void 0,function*(){return t.reactToChanges(n,r)}))}exports.watchBundles=c;
},{"./react-to-changes":"helpers/react-to-changes.ts"}],"app/app.module.ts":[function(require,module,exports) {
"use strict";var e=this&&this.__decorate||function(e,r,t,i){var s,n=arguments.length,o=n<3?r:null===i?i=Object.getOwnPropertyDescriptor(r,t):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,r,t,i);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(n<3?s(o):n>3?s(r,t,o):s(r,t))||o);return n>3&&o&&Object.defineProperty(r,t,o),o},r=this&&this.__awaiter||function(e,r,t,i){return new(t||(t=Promise))(function(s,n){function o(e){try{c(i.next(e))}catch(r){n(r)}}function a(e){try{c(i.throw(e))}catch(r){n(r)}}function c(e){e.done?s(e.value):new t(function(r){r(e.value)}).then(o,a)}c((i=i.apply(e,r||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0});const t=require("@gapi/core"),i=require("fs"),s=require("util"),n=require("../helpers/args-extractors"),o=require("@gapi/voyager"),a=require("../helpers/set-config"),c=require("../helpers/basic.template"),l=require("../helpers/advanced-schema"),u=require("../helpers/basic-schema"),d=require("path"),p=require("./app.tokens"),h=require("../helpers/transpile-and-load"),f=require("../helpers/traverse/test"),m=require("../helpers/traverse-map"),g=require("../helpers/watch-bundles");let y=class{};y=e([t.Module({imports:[o.VoyagerModule.forRoot()],providers:[{provide:p.TypesToken,useValue:new Map},{provide:p.ResolversToken,useValue:new Map},{provide:p.ArgumentsToken,useValue:new Map},{provide:p.GuardsToken,useValue:new Map},{provide:t.SCHEMA_OVERRIDE,useFactory:()=>e=>{let r;try{const e=JSON.parse(i.readFileSync(d.join(process.cwd(),"gj.json"),{encoding:"utf-8"}));e.$schema=e.$schema||n.nextOrDefault("--schema",!1),e.$schema&&(r=i.readFileSync(e.$schema,{encoding:"utf-8"}),r=t.buildSchema(r))}catch(c){}const o=[r,e].filter(e=>!!e);let a;return a=1===o.length?e:t.mergeSchemas({schemas:o}),n.includes("--verbose")&&console.log(`\nSchema:\n${t.printSchema(a)}\n                  `),process.argv.toString().includes("--generate")&&s.promisify(i.writeFile)("./schema.graphql",t.printSchema(a),{encoding:"utf-8"}).then(()=>{console.log("Schema created!"),process.exit(0)}),a}},{provide:p.Config,useFactory:()=>r(this,void 0,void 0,function*(){let e=yield a.getConfig(n.nextOrDefault("--config","graphqj-config"));return e||(e=yield a.getConfig("gj")),e||(e=c.basicTemplate),e.default||e})},{provide:"Run",deps:[p.Config,t.BootstrapService,p.TypesToken,p.ResolversToken,p.ArgumentsToken,p.GuardsToken,t.GRAPHQL_PLUGIN_CONFIG],lazy:!0,useFactory:(e,n,o,a,c,p,y)=>r(this,void 0,void 0,function*(){if(e=yield e,(e=yield f.deep(e)).$externals){const r=yield h.TranspileAndGetAll(e.$externals,"./.gj/out");e.$externals=r.map(e=>{if(e.file.includes(".ts"))e.module=require(e.transpiledFile);else{const r=require("esm")(module)(d.join(process.cwd(),e.file));e.module=r.default||r}return t.Container.set(e.map,e.module),e})}let r,o=d.join(process.cwd(),e.$directives||"");return(yield s.promisify(i.exists)(o))&&o!==process.cwd()&&(r=o.includes(".ts")?yield h.TranspileAndLoad(e.$directives.replace(".",""),"./.gj/out"):require("esm")(module)(o),y.directives=(yield Promise.all(Object.keys(r).map(e=>"function"==typeof r[e]?r[e]():null))).filter(e=>!!e)),"basic"===e.$mode&&(yield u.MakeBasicSchema(e,n)),"advanced"===e.$mode&&(yield l.MakeAdvancedSchema(e)),g.watchBundles(m.traverseMap.map(e=>e.path),e),console.log("You can extract this schema by running --generate command"),!0})}]})],y),exports.AppModule=y;
},{"../helpers/args-extractors":"helpers/args-extractors.ts","../helpers/set-config":"helpers/set-config.ts","../helpers/basic.template":"helpers/basic.template.ts","../helpers/advanced-schema":"helpers/advanced-schema.ts","../helpers/basic-schema":"helpers/basic-schema.ts","./app.tokens":"app/app.tokens.ts","../helpers/transpile-and-load":"helpers/transpile-and-load.ts","../helpers/traverse/test":"helpers/traverse/test.ts","../helpers/traverse-map":"helpers/traverse-map.ts","../helpers/watch-bundles":"helpers/watch-bundles.ts"}],"helpers/self-child.ts":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const e=require("child_process"),s=require("rxjs");exports.SelfChild=(r=>new s.Observable(s=>{const o=[];o.push("--config"),o.push(r);const t=e.spawn("gj",o);return t.stdout.pipe(process.stdout),t.stderr.pipe(process.stderr),process.on("exit",()=>t.kill()),s.next(t),()=>{s.complete(),t.kill(),console.log(`Child process: ${t.pid} killed`)}}));
},{}],"main.ts":[function(require,module,exports) {
"use strict";var n=this&&this.__awaiter||function(n,e,r,i){return new(r||(r=Promise))(function(s,t){function a(n){try{u(i.next(n))}catch(e){t(e)}}function o(n){try{u(i.throw(n))}catch(e){t(e)}}function u(n){n.done?s(n.value):new r(function(e){e(n.value)}).then(a,o)}u((i=i.apply(n,e||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0});const e=require("@rxdi/core"),r=require("./app/app.module"),i=require("@gapi/core"),s=require("./helpers/args-extractors"),t=require("fs"),a=require("util"),o=require("chokidar"),u=require("./helpers/self-child");if(s.includes("--watch")){let e;const r=s.nextOrDefault("--config");if(!t.existsSync(r))throw new Error(`File missing ${r}`);const i=n=>n.includes("node_modules");o.watch(r,{ignored:i}).on("change",(i,s)=>n(this,void 0,void 0,function*(){e&&e.unsubscribe(),e=u.SelfChild(r).subscribe(n=>{console.log("Child process started: ",n.pid)})})),o.watch(r,{ignored:i}).on("ready",(i,s)=>n(this,void 0,void 0,function*(){e&&e.unsubscribe(),e=u.SelfChild(r).subscribe(n=>{console.log("Child process started: ",n.pid)})}))}else s.includes("init")?s.includes("advanced")?a.promisify(t.writeFile)("./gj.json",'\n{\n  "$mode": "advanced",\n  "$types": {\n    "user": {\n      "name": "String",\n      "email": "String",\n      "phone": "Number",\n      "arrayOfNumbers": "Number[]",\n      "arrayOfStrings": "String[]"\n    }\n  },\n  "$resolvers": {\n    "findUser": {\n      "type": "user",\n      "resolve": {\n        "name": "Kristiyan Tachev",\n        "email": "test@gmail.com",\n        "phone": 414141,\n        "arrayOfNumbers": [515151, 412414],\n        "arrayOfStrings": ["515151", "412414"]\n      }\n    }\n  }\n}',{encoding:"utf-8"}):s.includes("es6")?a.promisify(t.writeFile)("./gj.js","\nexport default {\n  $mode: 'advanced',\n  $types: {\n    user: {\n      name: 'String',\n      email: 'String',\n      phone: 'Number',\n      arrayOfNumbers: 'Number[]',\n      arrayOfStrings: 'String[]'\n    }\n  },\n  $resolvers: {\n    findUser: {\n      type: 'user',\n      args: {\n        userId: \"String!\",\n        userId2: \"String\",\n      },\n      resolve: async (root, payload, context) => ({\n        name: 'Kristiyan Tachev',\n        email: 'test@gmail.com',\n        phone: 4141423,\n        arrayOfNumbers: [515151, 412414],\n        arrayOfStrings: ['515151', '412414']\n      })\n    }\n  }\n};\n",{encoding:"utf-8"}):s.includes("typescript")?a.promisify(t.writeFile)("./gj.ts","\nexport default {\n  $mode: 'advanced',\n  $types: {\n    user: {\n      name: 'String',\n      email: 'String',\n      phone: 'Number',\n      arrayOfNumbers: 'Number[]',\n      arrayOfStrings: 'String[]'\n    }\n  },\n  $resolvers: {\n    findUser: {\n      type: 'user',\n      args: {\n        userId: \"String!\",\n        userId2: \"String\",\n      },\n      resolve: async (root, payload: { userId: string; userId2?: string }) => ({\n        name: 'Kristiyan Tachev',\n        email: 'test@gmail.com',\n        phone: 4141423,\n        arrayOfNumbers: [515151, 412414],\n        arrayOfStrings: ['515151', '412414']\n      })\n    }\n  }\n};\n",{encoding:"utf-8"}):s.includes("yml")?a.promisify(t.writeFile)("./gj.yml","\n$mode: advanced\n$types:\n  user:\n    name: String\n    email: String\n    phone: Number\n    arrayOfNumbers: Number[]\n    arrayOfStrings: String[]\n\n$resolvers:\n  findUser:\n    type: user\n    args:\n      userId: String\n    resolve:\n      name: Kristiyan Tachev\n      email: test@gmail.com\n      phone: 414141\n      arrayOfNumbers: \n        - 515151\n        - 412414\n      arrayOfStrings:\n        - '515151'\n        - '412414'\n\n  findUser2:\n    type: user\n    args:\n      userId: String!\n    resolve:\n      name: Kristiyan Tachev\n      email: test@gmail.com\n      phone: 414141\n      arrayOfNumbers: \n        - 515151\n        - 412414\n      arrayOfStrings:\n        - '515151'\n        - '412414'\n",{encoding:"utf-8"}):a.promisify(t.writeFile)("./gj.json",'\n{\n  "$mode": "basic",\n  "$resolvers": {\n    "findUser": {\n      "name": "Kristiyan Tachev",\n      "email": "test@gmail.com",\n      "phone": 414141,\n      "arrayOfNumbers": [515151, 412414],\n      "arrayOfStrings": ["515151", "412414"]\n    }\n  }\n}\n',{encoding:"utf-8"}):e.BootstrapFramework(r.AppModule,[i.CoreModule.forRoot({graphql:{openBrowser:s.nextOrDefault("--random",!0,n=>"true"!==n),buildAstDefinitions:!1},server:{randomPort:s.nextOrDefault("--random",!1),hapi:{port:s.nextOrDefault("--port",9e3,n=>Number(n))}}})]).subscribe(()=>console.log("Started"),console.log.bind(console));
},{"./app/app.module":"app/app.module.ts","./helpers/args-extractors":"helpers/args-extractors.ts","./helpers/self-child":"helpers/self-child.ts"}]},{},["main.ts"], null)
//# sourceMappingURL=/main.js.map