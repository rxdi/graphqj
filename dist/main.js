#!/usr/bin/env node
parcelRequire=function(e,r,t,n){var i,o="function"==typeof parcelRequire&&parcelRequire,u="function"==typeof require&&require;function f(t,n){if(!r[t]){if(!e[t]){var i="function"==typeof parcelRequire&&parcelRequire;if(!n&&i)return i(t,!0);if(o)return o(t,!0);if(u&&"string"==typeof t)return u(t);var c=new Error("Cannot find module '"+t+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(r){return e[t][1][r]||r},p.cache={};var l=r[t]=new f.Module(t);e[t][0].call(l.exports,p,l,l.exports,this)}return r[t].exports;function p(e){return f(p.resolve(e))}}f.isParcelRequire=!0,f.Module=function(e){this.id=e,this.bundle=f,this.exports={}},f.modules=e,f.cache=r,f.parent=o,f.register=function(r,t){e[r]=[function(e,r){r.exports=t},{}]};for(var c=0;c<t.length;c++)try{f(t[c])}catch(e){i||(i=e)}if(t.length){var l=f(t[t.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=l:"function"==typeof define&&define.amd?define(function(){return l}):n&&(this[n]=l)}if(parcelRequire=f,i)throw i;return f}({"helpers/args-extractors.ts":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.includes=(e=>process.argv.toString().includes(e)),exports.nextOrDefault=((e,r=!0,s=(e=>e))=>{if(process.argv.toString().includes(e)){const t=process.argv[process.argv.indexOf(e)+1];return t?t.includes("--")?r:s(t):r}return r});
},{}],"helpers/typescript.builder.ts":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const e=require("child_process");exports.TranspileTypescript=((r,s)=>new Promise((o,t)=>{const p=e.spawn("npx",["gapi","build","--glob",`${r.toString()}`,"--outDir",s]);p.stderr.pipe(process.stderr),p.on("close",e=>o(e))}));
},{}],"helpers/set-config.ts":[function(require,module,exports) {
"use strict";var i=this&&this.__awaiter||function(i,e,o,t){return new(o||(o=Promise))(function(n,s){function r(i){try{l(t.next(i))}catch(e){s(e)}}function c(i){try{l(t.throw(i))}catch(e){s(e)}}function l(i){i.done?n(i.value):new o(function(e){e(i.value)}).then(r,c)}l((t=t.apply(i,e||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0});const e=require("util"),o=require("fs"),t=require("./typescript.builder"),n=require("path"),s=require("js-yaml");function r(r){return i(this,void 0,void 0,function*(){let c;try{c=require("esm")(module)(n.join(process.cwd(),`${r}.js`)),console.log("JS Config",c)}catch(l){}if(yield e.promisify(o.exists)(`./${r}.yml`)){const i=o.readFileSync(`./${r}.yml`,{encoding:"utf-8"});c=s.load(i),console.log("YML Config",c)}if(yield e.promisify(o.exists)(`./${r}.ts`)){console.log("Typescript Config",c);const s=yield e.promisify(o.exists)("./.gj/config.temp"),f=n=>i(this,void 0,void 0,function*(){yield t.TranspileTypescript([`/${r}.ts`],"./.gj"),console.log("Transpile complete!"),yield e.promisify(o.writeFile)("./.gj/config.temp",n.mtime.toISOString(),{encoding:"utf-8"})}),p=yield e.promisify(o.stat)(`./${r}.ts`);if(s){const i=yield e.promisify(o.readFile)("./.gj/config.temp",{encoding:"utf-8"});new Date(i).toISOString()!==p.mtime.toISOString()&&(console.log(`${r} configuration is new transpiling...`),yield f(p))}else console.log(`Transpile ${r}.ts...`),yield f(p);c=require(n.join(process.cwd(),"./.gj",`${r}.js`));try{yield e.promisify(o.unlink)(n.join("./.gj",`${r}.js.map`))}catch(l){}}try{c=JSON.parse(yield e.promisify(o.readFile)(n.join(process.cwd(),`${r}.json`),{encoding:"utf-8"})),console.log("Json Config",c)}catch(l){}return c})}exports.getConfig=r;
},{"./typescript.builder":"helpers/typescript.builder.ts"}],"helpers/basic.template.ts":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.basicTemplate={$mode:"basic",$types:{user:{pesho:"string"}},$schema:"./schema.graphql",$resolvers:{findUser:{gosho:"omg",pesho:515151,pesho2:515151,pesho3:515151,dadadada:515151,pesho4:515151,pesho5:[515151],pesho6:["515151"]},findUser2:{gosho:"omg",pesho:22,pesho2:515151,pesho3:515151,pesho4:515151,pesho5:515151}}};
},{}],"app/app.tokens.ts":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const e=require("@rxdi/core");function n(e){return e.reduce((e,n)=>(e[n]=n,e),Object.create(null))}exports.BooleanUnion=n(["Boolean","Bool","boolean","Boolean[]","boolean[]","[Boolean]","[Bool]","boolean!","Boolean!","[Boolean]!","boolean[]!","Boolean[]!"]),exports.StringUnion=n(["String","string","String[]","string[]","[String]","string!","String!","String[]!","string[]!","[String]!"]),exports.IntegerUnion=n(["Int","integer","number","Number","Num","int","Number[]","number[]","[Number]","number!","[Int]","Number!","number[]!","Number[]!","[Number]!","[Int]!"]),exports.Roots={booleanNode:exports.BooleanUnion,stringNode:exports.StringUnion,numberNode:exports.IntegerUnion},exports.TypesToken=new e.InjectionToken("(@rxdi/graphqj): types-token"),exports.ArgumentsToken=new e.InjectionToken("(@rxdi/graphqj): arguments-token"),exports.ResolversToken=new e.InjectionToken("(@rxdi/graphqj): resolvers-token"),exports.GuardsToken=new e.InjectionToken("(@rxdi/graphqj): resolvers-token"),exports.Config=new e.InjectionToken;
},{}],"helpers/parse-ast.ts":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const n=require("graphql");function e(e){let r;return"string"!==e&&"String"!==e||(r={type:n.GraphQLString}),"boolean"!==e&&"Boolean"!==e&&"Bool"!==e||(r={type:n.GraphQLBoolean}),"number"!==e&&"Number"!==e&&"Int"!==e||(r={type:n.GraphQLInt}),"string!"!==e&&"String!"!==e||(r={type:new n.GraphQLNonNull(n.GraphQLString)}),"boolean!"!==e&&"Boolean!"!==e||(r={type:new n.GraphQLNonNull(n.GraphQLString)}),"number!"!==e&&"Number!"!==e&&"Int"!==e||(r={type:new n.GraphQLNonNull(n.GraphQLInt)}),"string[]"!==e&&"String[]"!==e&&"[String]"!==e||(r={type:new n.GraphQLList(n.GraphQLString)}),"boolean[]"!==e&&"Boolean[]"!==e&&"[Boolean]"!==e&&"[Bool]"!==e||(r={type:new n.GraphQLList(n.GraphQLBoolean)}),"number[]"!==e&&"Number[]"!==e&&"[Number]"!==e&&"[Int]"!==e||(r={type:new n.GraphQLList(n.GraphQLInt)}),"string[]!"!==e&&"String[]!"!==e&&"[String]!"!==e||(r={type:new n.GraphQLNonNull(new n.GraphQLList(n.GraphQLString))}),"boolean[]!"!==e&&"Boolean[]!"!==e&&"[Boolean]!"!==e&&"[Bool]"!==e||(r={type:new n.GraphQLNonNull(new n.GraphQLList(n.GraphQLBoolean))}),"number[]!"!==e&&"Number[]!"!==e&&"[Number]!"!==e&&"[Int]!"!==e||(r={type:new n.GraphQLNonNull(new n.GraphQLList(n.GraphQLInt))}),r}exports.ParseArgs=e;
},{}],"helpers/parse-args-schema.ts":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const e=require("graphql"),r=require("@rxdi/core"),t=require("./parse-ast"),s=require("../app/app.tokens"),a=new Map;exports.buildArgumentsSchema=((p,n)=>{let o=p.$resolvers[n].args||{},l={};const u=r.Container.get(s.TypesToken);return Object.keys(o).forEach(r=>{const s=o[r].replace("!","");if(u.has(s)){let t=new e.GraphQLInputObjectType({name:s,fields:()=>u.get(s)});return a.has(s)&&(t=a.get(s)),a.set(s,t),void(l=o[r].includes("!")?{payload:{type:new e.GraphQLNonNull(t)}}:{payload:{type:t}})}l[r]=t.ParseArgs(o[r])}),l});
},{"./parse-ast":"helpers/parse-ast.ts","../app/app.tokens":"app/app.tokens.ts"}],"helpers/parse-types.schema.ts":[function(require,module,exports) {
"use strict";var e=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,o){function a(e){try{p(r.next(e))}catch(t){o(t)}}function u(e){try{p(r.throw(e))}catch(t){o(t)}}function p(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(a,u)}p((r=r.apply(e,t||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0});const t=require("graphql"),n=require("@rxdi/core");function r(r,i,o,a){let u;return"string"!==r&&"String"!==r||(u={type:t.GraphQLString}),"boolean"!==r&&"Boolean"!==r||(u={type:t.GraphQLString}),"number"!==r&&"Number"!==r||(u={type:t.GraphQLInt}),"string[]"!==r&&"String[]"!==r&&"[String]"!==r||(u={type:new t.GraphQLList(t.GraphQLString)}),"boolean[]"!==r&&"Boolean[]"!==r&&"[Boolean]"!==r||(u={type:new t.GraphQLList(t.GraphQLString)}),"number[]"!==r&&"Number[]"!==r&&"[Number]"!==r||(u={type:new t.GraphQLList(t.GraphQLInt)}),u.resolve=function(...t){return e(this,void 0,void 0,function*(){let e=t[0][i];for(const t of o)yield n.Container.get(t)(e);return a&&(e=yield a(e)),e})},u}exports.ParseTypesSchema=r;
},{}],"helpers/advanced-schema.ts":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const e=require("graphql"),s=require("@gapi/core"),r=require("../app/app.tokens"),t=require("./parse-ast"),o=require("./parse-args-schema"),n=require("./parse-types.schema"),a=require("path");function c(c,i){const p={};console.log(c.$externals);s.Container.get(r.TypesToken);const l=s.Container.get(r.TypesToken);s.Container.get(r.TypesToken);Object.keys(c.$args).forEach(e=>{const s={};Object.keys(c.$args[e]).forEach(r=>{s[r]=t.ParseArgs(c.$args[e][r]),l.set(e,s)})}),Object.keys(c.$types).forEach(t=>{if(p[t])return;const o=c.$types[t];Object.keys(o).forEach(e=>{p[t]=p[t]||{};let i=o[e];const l=[];if(c.$externals.filter(e=>i.includes(e.map)).length){let e="(",t=")";i.includes("{")&&(e="{",t="}");const o=i.split(e)[1].replace(t,"").split("@"),n=o[0],p=o[1].replace(/ +?/g,""),u=c.$externals.find(e=>e.map===n);let y;if(!(y=process.env.LAZY?require("esm")(module)(a.join(process.cwd(),u.file)):u.module)[p])throw new Error(`Missing method ${p} inside ${u.file}`);const h=new s.InjectionToken(s.createUniqueHash(`${y[p]}`));s.Container.set(h,y[p]),l.push(h),i=Object.keys(r.Roots).map(e=>{const s=Object.keys(r.Roots[e]).filter(e=>i.includes(e));if(s.length)return s[0]}).filter(e=>!!e)[0]}p[t][e]=n.ParseTypesSchema(i,e,l)}),p[t]=new e.GraphQLObjectType({name:t,fields:p[t]})}),Object.keys(c.$resolvers).forEach(e=>{const s=c.$resolvers[e].type;if(!p[s])throw new Error(`Missing type '${s}', Available types: '${Object.keys(p).toString()}'`);const r=c.$resolvers[e].resolve;i.Fields.query[e]={type:p[s],method_name:e,args:o.buildArgumentsSchema(c,e),public:!0,method_type:"query",target:()=>{},resolve:"function"==typeof r?r:()=>r}})}exports.MakeAdvancedSchema=c;
},{"../app/app.tokens":"app/app.tokens.ts","./parse-ast":"helpers/parse-ast.ts","./parse-args-schema":"helpers/parse-args-schema.ts","./parse-types.schema":"helpers/parse-types.schema.ts"}],"helpers/basic-schema.ts":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const e=require("graphql");function t(t,r){Object.keys(t.$resolvers).forEach(p=>{const o=t.$resolvers[p],n={};Object.keys(o).forEach(t=>{const r=o[t];"string"==typeof r&&(n[t]={type:e.GraphQLString}),"number"==typeof r&&(n[t]={type:e.GraphQLInt}),"boolean"==typeof r&&(n[t]={type:e.GraphQLBoolean}),"string"!=typeof r&&r.length&&("string"==typeof r[0]&&(n[t]={type:new e.GraphQLList(e.GraphQLString)}),"number"==typeof r[0]&&(n[t]={type:new e.GraphQLList(e.GraphQLInt)}),"boolean"==typeof r[0]&&(n[t]={type:new e.GraphQLList(e.GraphQLBoolean)}))}),r.Fields.query[p]={type:new e.GraphQLObjectType({name:`${p}_type`,fields:()=>n}),args:{},method_name:p,public:!0,method_type:"query",target:()=>{},resolve:"function"==typeof o?o:()=>o}})}exports.MakeBasicSchema=t;
},{}],"app/app.module.ts":[function(require,module,exports) {
"use strict";var e=this&&this.__decorate||function(e,r,t,o){var n,a=arguments.length,i=a<3?r:null===o?o=Object.getOwnPropertyDescriptor(r,t):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,r,t,o);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(i=(a<3?n(i):a>3?n(r,t,i):n(r,t))||i);return a>3&&i&&Object.defineProperty(r,t,i),i},r=this&&this.__awaiter||function(e,r,t,o){return new(t||(t=Promise))(function(n,a){function i(e){try{c(o.next(e))}catch(r){a(r)}}function s(e){try{c(o.throw(e))}catch(r){a(r)}}function c(e){e.done?n(e.value):new t(function(r){r(e.value)}).then(i,s)}c((o=o.apply(e,r||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0});const t=require("@gapi/core"),o=require("fs"),n=require("util"),a=require("../helpers/args-extractors"),i=require("@gapi/voyager"),s=require("../helpers/set-config"),c=require("../helpers/basic.template"),u=require("../helpers/advanced-schema"),l=require("../helpers/basic-schema"),d=require("path"),p=require("./app.tokens");let h=class{};h=e([t.Module({imports:[i.VoyagerModule.forRoot()],providers:[{provide:p.TypesToken,useValue:new Map},{provide:p.ResolversToken,useValue:new Map},{provide:p.ArgumentsToken,useValue:new Map},{provide:p.GuardsToken,useValue:new Map},{provide:t.SCHEMA_OVERRIDE,useFactory:()=>e=>{let r;try{const e=JSON.parse(o.readFileSync(d.join(process.cwd(),"gj.json"),{encoding:"utf-8"}));e.$schema=e.$schema||a.nextOrDefault("--schema",!1),e.$schema&&(r=o.readFileSync(e.$schema,{encoding:"utf-8"}),r=t.buildSchema(r))}catch(s){}const i=t.mergeSchemas({schemas:[r,e].filter(e=>!!e)});return a.includes("--verbose")&&console.log(`\nSchema:\n${t.printSchema(i)}\n                  `),process.argv.toString().includes("--generate")?n.promisify(o.writeFile)("./schema.graphql",t.printSchema(i),{encoding:"utf-8"}).then(()=>{console.log("Schema created!"),process.exit(0)}):console.log("You can extract this schema by running --generate command"),i}},{provide:p.Config,useFactory:()=>r(this,void 0,void 0,function*(){let e=yield s.getConfig(a.nextOrDefault("--config","graphqj-config"));return e||(e=yield s.getConfig("gj")),e||(e=c.basicTemplate),e.default||e})},{provide:"Run",deps:[p.Config,t.BootstrapService,p.TypesToken,p.ResolversToken,p.ArgumentsToken,p.GuardsToken],lazy:!0,useFactory:(e,o,n,a,i,s)=>r(this,void 0,void 0,function*(){return(e=yield e).$externals.map(e=>{const r=require("esm")(module)(d.join(process.cwd(),e.file));e.module=r.default||r,t.Container.set(e.map,e.module)}),"basic"===e.$mode&&l.MakeBasicSchema(e,o),"advanced"===e.$mode&&u.MakeAdvancedSchema(e,o),!0})}]})],h),exports.AppModule=h;
},{"../helpers/args-extractors":"helpers/args-extractors.ts","../helpers/set-config":"helpers/set-config.ts","../helpers/basic.template":"helpers/basic.template.ts","../helpers/advanced-schema":"helpers/advanced-schema.ts","../helpers/basic-schema":"helpers/basic-schema.ts","./app.tokens":"app/app.tokens.ts"}],"helpers/self-child.ts":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const e=require("child_process"),s=require("rxjs");exports.SelfChild=(r=>new s.Observable(s=>{const o=[];o.push("--config"),o.push(r);const t=e.spawn("gj",o);return t.stdout.pipe(process.stdout),t.stderr.pipe(process.stderr),process.on("exit",()=>t.kill()),s.next(t),()=>{s.complete(),t.kill(),console.log(`Child process: ${t.pid} killed`)}}));
},{}],"main.ts":[function(require,module,exports) {
"use strict";var n=this&&this.__awaiter||function(n,e,r,i){return new(r||(r=Promise))(function(s,t){function a(n){try{u(i.next(n))}catch(e){t(e)}}function o(n){try{u(i.throw(n))}catch(e){t(e)}}function u(n){n.done?s(n.value):new r(function(e){e(n.value)}).then(a,o)}u((i=i.apply(n,e||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0});const e=require("@rxdi/core"),r=require("./app/app.module"),i=require("@gapi/core"),s=require("./helpers/args-extractors"),t=require("fs"),a=require("util"),o=require("chokidar"),u=require("./helpers/self-child");if(s.includes("--watch")){let e;const r=s.nextOrDefault("--config");if(!t.existsSync(r))throw new Error(`File missing ${r}`);const i=n=>n.includes("node_modules");o.watch(r,{ignored:i}).on("change",(i,s)=>n(this,void 0,void 0,function*(){e&&e.unsubscribe(),e=u.SelfChild(r).subscribe(n=>{console.log("Child process started: ",n.pid)})})),o.watch(r,{ignored:i}).on("ready",(i,s)=>n(this,void 0,void 0,function*(){e&&e.unsubscribe(),e=u.SelfChild(r).subscribe(n=>{console.log("Child process started: ",n.pid)})}))}else s.includes("init")?s.includes("advanced")?a.promisify(t.writeFile)("./gj.json",'\n{\n  "$mode": "advanced",\n  "$types": {\n    "user": {\n      "name": "String",\n      "email": "String",\n      "phone": "Number",\n      "arrayOfNumbers": "Number[]",\n      "arrayOfStrings": "String[]"\n    }\n  },\n  "$resolvers": {\n    "findUser": {\n      "type": "user",\n      "resolve": {\n        "name": "Kristiyan Tachev",\n        "email": "test@gmail.com",\n        "phone": 414141,\n        "arrayOfNumbers": [515151, 412414],\n        "arrayOfStrings": ["515151", "412414"]\n      }\n    }\n  }\n}',{encoding:"utf-8"}):s.includes("es6")?a.promisify(t.writeFile)("./gj.js","\nexport default {\n  $mode: 'advanced',\n  $types: {\n    user: {\n      name: 'String',\n      email: 'String',\n      phone: 'Number',\n      arrayOfNumbers: 'Number[]',\n      arrayOfStrings: 'String[]'\n    }\n  },\n  $resolvers: {\n    findUser: {\n      type: 'user',\n      args: {\n        userId: \"String!\",\n        userId2: \"String\",\n      },\n      resolve: async (root, payload, context) => ({\n        name: 'Kristiyan Tachev',\n        email: 'test@gmail.com',\n        phone: 4141423,\n        arrayOfNumbers: [515151, 412414],\n        arrayOfStrings: ['515151', '412414']\n      })\n    }\n  }\n};\n",{encoding:"utf-8"}):s.includes("typescript")?a.promisify(t.writeFile)("./gj.ts","\nexport default {\n  $mode: 'advanced',\n  $types: {\n    user: {\n      name: 'String',\n      email: 'String',\n      phone: 'Number',\n      arrayOfNumbers: 'Number[]',\n      arrayOfStrings: 'String[]'\n    }\n  },\n  $resolvers: {\n    findUser: {\n      type: 'user',\n      args: {\n        userId: \"String!\",\n        userId2: \"String\",\n      },\n      resolve: async (root, payload: { userId: string; userId2?: string }) => ({\n        name: 'Kristiyan Tachev',\n        email: 'test@gmail.com',\n        phone: 4141423,\n        arrayOfNumbers: [515151, 412414],\n        arrayOfStrings: ['515151', '412414']\n      })\n    }\n  }\n};\n",{encoding:"utf-8"}):s.includes("yml")?a.promisify(t.writeFile)("./gj.yml","\n$mode: advanced\n$types:\n  user:\n    name: String\n    email: String\n    phone: Number\n    arrayOfNumbers: Number[]\n    arrayOfStrings: String[]\n\n$resolvers:\n  findUser:\n    type: user\n    args:\n      userId: String\n    resolve:\n      name: Kristiyan Tachev\n      email: test@gmail.com\n      phone: 414141\n      arrayOfNumbers: \n        - 515151\n        - 412414\n      arrayOfStrings:\n        - '515151'\n        - '412414'\n\n  findUser2:\n    type: user\n    args:\n      userId: String!\n    resolve:\n      name: Kristiyan Tachev\n      email: test@gmail.com\n      phone: 414141\n      arrayOfNumbers: \n        - 515151\n        - 412414\n      arrayOfStrings:\n        - '515151'\n        - '412414'\n",{encoding:"utf-8"}):a.promisify(t.writeFile)("./gj.json",'\n{\n  "$mode": "basic",\n  "$resolvers": {\n    "findUser": {\n      "name": "Kristiyan Tachev",\n      "email": "test@gmail.com",\n      "phone": 414141,\n      "arrayOfNumbers": [515151, 412414],\n      "arrayOfStrings": ["515151", "412414"]\n    }\n  }\n}\n',{encoding:"utf-8"}):e.BootstrapFramework(r.AppModule,[i.CoreModule.forRoot({graphql:{openBrowser:s.nextOrDefault("--random",!0,n=>"true"!==n)},server:{randomPort:s.nextOrDefault("--random",!1),hapi:{port:s.nextOrDefault("--port",9e3,n=>Number(n))}}})]).subscribe(()=>console.log("Started"),console.log.bind(console));
},{"./app/app.module":"app/app.module.ts","./helpers/args-extractors":"helpers/args-extractors.ts","./helpers/self-child":"helpers/self-child.ts"}]},{},["main.ts"], null)
//# sourceMappingURL=/main.js.map