#!/usr/bin/env node
parcelRequire=function(e,r,t,n){var i,o="function"==typeof parcelRequire&&parcelRequire,u="function"==typeof require&&require;function f(t,n){if(!r[t]){if(!e[t]){var i="function"==typeof parcelRequire&&parcelRequire;if(!n&&i)return i(t,!0);if(o)return o(t,!0);if(u&&"string"==typeof t)return u(t);var c=new Error("Cannot find module '"+t+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(r){return e[t][1][r]||r},p.cache={};var l=r[t]=new f.Module(t);e[t][0].call(l.exports,p,l,l.exports,this)}return r[t].exports;function p(e){return f(p.resolve(e))}}f.isParcelRequire=!0,f.Module=function(e){this.id=e,this.bundle=f,this.exports={}},f.modules=e,f.cache=r,f.parent=o,f.register=function(r,t){e[r]=[function(e,r){r.exports=t},{}]};for(var c=0;c<t.length;c++)try{f(t[c])}catch(e){i||(i=e)}if(t.length){var l=f(t[t.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=l:"function"==typeof define&&define.amd?define(function(){return l}):n&&(this[n]=l)}if(parcelRequire=f,i)throw i;return f}({"helpers/args-extractors.ts":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.includes=(e=>process.argv.toString().includes(e)),exports.nextOrDefault=((e,r=!0,s=(e=>e))=>{if(process.argv.toString().includes(e)){const t=process.argv[process.argv.indexOf(e)+1];return t?t.includes("--")?r:s(t):r}return r});
},{}],"helpers/typescript.builder.ts":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const e=require("child_process");exports.TranspileTypescript=((r,s)=>new Promise((o,t)=>{const p=e.spawn("npx",["gapi","build","--glob",`${r.toString()}`,"--outDir",s]);p.stderr.pipe(process.stderr),p.on("close",e=>o(e))}));
},{}],"helpers/set-config.ts":[function(require,module,exports) {
"use strict";var i=this&&this.__awaiter||function(i,e,o,t){return new(o||(o=Promise))(function(n,s){function r(i){try{l(t.next(i))}catch(e){s(e)}}function c(i){try{l(t.throw(i))}catch(e){s(e)}}function l(i){i.done?n(i.value):new o(function(e){e(i.value)}).then(r,c)}l((t=t.apply(i,e||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0});const e=require("util"),o=require("fs"),t=require("./typescript.builder"),n=require("path"),s=require("js-yaml");function r(r){return i(this,void 0,void 0,function*(){let c;try{c=require("esm")(module)(n.join(process.cwd(),`${r}.js`)),console.log("JS Config",c)}catch(l){}if(yield e.promisify(o.exists)(`./${r}.yml`)){const i=o.readFileSync(`./${r}.yml`,{encoding:"utf-8"});c=s.load(i),console.log("YML Config",c)}if(yield e.promisify(o.exists)(`./${r}.ts`)){console.log("Typescript Config",c);const s=yield e.promisify(o.exists)("./.gj/config.temp"),f=n=>i(this,void 0,void 0,function*(){yield t.TranspileTypescript([`/${r}.ts`],"./.gj"),console.log("Transpile complete!"),yield e.promisify(o.writeFile)("./.gj/config.temp",n.mtime.toISOString(),{encoding:"utf-8"})}),p=yield e.promisify(o.stat)(`./${r}.ts`);if(s){const i=yield e.promisify(o.readFile)("./.gj/config.temp",{encoding:"utf-8"});new Date(i).toISOString()!==p.mtime.toISOString()&&(console.log(`${r} configuration is new transpiling...`),yield f(p))}else console.log(`Transpile ${r}.ts...`),yield f(p);c=require(n.join(process.cwd(),"./.gj",`${r}.js`));try{yield e.promisify(o.unlink)(n.join("./.gj",`${r}.js.map`))}catch(l){}}try{c=JSON.parse(yield e.promisify(o.readFile)(n.join(process.cwd(),`${r}.json`),{encoding:"utf-8"})),console.log("Json Config",c)}catch(l){}return c})}exports.getConfig=r;
},{"./typescript.builder":"helpers/typescript.builder.ts"}],"helpers/basic.template.ts":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.basicTemplate={$mode:"basic",$types:{user:{pesho:"string"}},$schema:"./schema.graphql",$resolvers:{findUser:{gosho:"omg",pesho:515151,pesho2:515151,pesho3:515151,dadadada:515151,pesho4:515151,pesho5:[515151],pesho6:["515151"]},findUser2:{gosho:"omg",pesho:22,pesho2:515151,pesho3:515151,pesho4:515151,pesho5:515151}}};
},{}],"helpers/advanced-schema.ts":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const e=require("graphql");function r(r,t){const n={};Object.keys(r.$types).forEach(t=>{n[t]||(Object.keys(r.$types[t]).forEach(o=>{n[t]=n[t]||{};const a=r.$types[t][o];"string"!==a&&"String"!==a||(n[t][o]={type:e.GraphQLString}),"boolean"!==a&&"Boolean"!==a||(n[t][o]={type:e.GraphQLString}),"number"!==a&&"Number"!==a||(n[t][o]={type:e.GraphQLInt}),"string[]"!==a&&"String[]"!==a||(n[t][o]={type:new e.GraphQLList(e.GraphQLString)}),"boolean[]"!==a&&"Boolean[]"!==a||(n[t][o]={type:new e.GraphQLList(e.GraphQLString)}),"number[]"!==a&&"Number[]"!==a||(n[t][o]={type:new e.GraphQLList(e.GraphQLInt)})}),n[t]=new e.GraphQLObjectType({name:t,fields:n[t]}))});const o=r=>{const t={};return r=r||t,Object.keys(r).forEach(n=>{const o=r[n];"string"!==o&&"String"!==o||(t[n]={type:e.GraphQLString}),"boolean"!==o&&"Boolean"!==o||(t[n]={type:e.GraphQLBoolean}),"string[]"!==o&&"String[]"!==o||(t[n]={type:new e.GraphQLList(e.GraphQLString)}),"boolean[]"!==o&&"Boolean[]"!==o||(t[n]={type:new e.GraphQLList(e.GraphQLBoolean)}),"string!"!==o&&"String!"!==o||(t[n]={type:new e.GraphQLNonNull(e.GraphQLString)}),"boolean!"!==o&&"Boolean!"!==o||(t[n]={type:new e.GraphQLNonNull(e.GraphQLString)}),"string[]!"!==o&&"String[]!"!==o||(t[n]={type:new e.GraphQLNonNull(new e.GraphQLList(e.GraphQLString))})}),t};Object.keys(r.$resolvers).forEach(e=>{const a=r.$resolvers[e].resolve,p=r.$resolvers[e].type;if(!n[p])throw new Error(`Missing type '${p}', Available types: '${Object.keys(n).toString()}'`);t.Fields.query[e]={type:n[p],method_name:e,args:o(r.$resolvers[e].args),public:!0,method_type:"query",target:()=>{},resolve:"function"==typeof a?a:()=>a}})}exports.MakeAdvancedSchema=r;
},{}],"helpers/basic-schema.ts":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const e=require("graphql");function t(t,r){Object.keys(t.$resolvers).forEach(p=>{const o=t.$resolvers[p],n={};Object.keys(o).forEach(t=>{const r=o[t];"string"==typeof r&&(n[t]={type:e.GraphQLString}),"number"==typeof r&&(n[t]={type:e.GraphQLInt}),"boolean"==typeof r&&(n[t]={type:e.GraphQLBoolean}),"string"!=typeof r&&r.length&&("string"==typeof r[0]&&(n[t]={type:new e.GraphQLList(e.GraphQLString)}),"number"==typeof r[0]&&(n[t]={type:new e.GraphQLList(e.GraphQLInt)}),"boolean"==typeof r[0]&&(n[t]={type:new e.GraphQLList(e.GraphQLBoolean)}))}),r.Fields.query[p]={type:new e.GraphQLObjectType({name:`${p}_type`,fields:()=>n}),args:{},method_name:p,public:!0,method_type:"query",target:()=>{},resolve:"function"==typeof o?o:()=>o}})}exports.MakeBasicSchema=t;
},{}],"app/app.module.ts":[function(require,module,exports) {
"use strict";var e=this&&this.__decorate||function(e,r,t,c){var o,a=arguments.length,n=a<3?r:null===c?c=Object.getOwnPropertyDescriptor(r,t):c;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,r,t,c);else for(var i=e.length-1;i>=0;i--)(o=e[i])&&(n=(a<3?o(n):a>3?o(r,t,n):o(r,t))||n);return a>3&&n&&Object.defineProperty(r,t,n),n},r=this&&this.__awaiter||function(e,r,t,c){return new(t||(t=Promise))(function(o,a){function n(e){try{s(c.next(e))}catch(r){a(r)}}function i(e){try{s(c.throw(e))}catch(r){a(r)}}function s(e){e.done?o(e.value):new t(function(r){r(e.value)}).then(n,i)}s((c=c.apply(e,r||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0});const t=require("@gapi/core"),c=require("fs"),o=require("util"),a=require("../helpers/args-extractors"),n=require("@gapi/voyager"),i=require("../helpers/set-config"),s=require("../helpers/basic.template"),l=require("../helpers/advanced-schema"),u=require("../helpers/basic-schema"),h=require("path");let d=class{};d=e([t.Module({imports:[n.VoyagerModule.forRoot()],providers:[{provide:t.SCHEMA_OVERRIDE,useFactory:()=>e=>{let r;try{const e=JSON.parse(c.readFileSync(h.join(process.cwd(),"gj.json"),{encoding:"utf-8"}));e.$schema=e.$schema||a.nextOrDefault("--schema",!1),e.$schema&&(r=c.readFileSync(e.$schema,{encoding:"utf-8"}),r=t.buildSchema(r))}catch(i){}const n=t.mergeSchemas({schemas:[r,e].filter(e=>!!e)});return a.includes("--verbose")&&console.log(`\nSchema:\n${t.printSchema(n)}\n                  `),process.argv.toString().includes("--generate")?o.promisify(c.writeFile)("./schema.graphql",t.printSchema(n),{encoding:"utf-8"}).then(()=>{console.log("Schema created!"),process.exit(0)}):console.log("You can extract this schema by running --extract command"),n}},{provide:"createFields",deps:[t.BootstrapService],lazy:!0,useFactory:e=>r(this,void 0,void 0,function*(){let r=yield i.getConfig(a.nextOrDefault("--config","graphqj-config"));return r||(r=yield i.getConfig("gj")),r||(r=s.basicTemplate),"basic"===(r=r.default||r).$mode&&u.MakeBasicSchema(r,e),"advanced"===r.$mode&&l.MakeAdvancedSchema(r,e),!0})}]})],d),exports.AppModule=d;
},{"../helpers/args-extractors":"helpers/args-extractors.ts","../helpers/set-config":"helpers/set-config.ts","../helpers/basic.template":"helpers/basic.template.ts","../helpers/advanced-schema":"helpers/advanced-schema.ts","../helpers/basic-schema":"helpers/basic-schema.ts"}],"main.ts":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const e=require("@rxdi/core"),r=require("./app/app.module"),n=require("@gapi/core"),o=require("./helpers/args-extractors"),s=require("fs"),a=require("util");o.includes("init")?o.includes("advanced")?a.promisify(s.writeFile)("./gj.json",'\n{\n  "$mode": "advanced",\n  "$types": {\n    "user": {\n      "name": "string",\n      "email": "string",\n      "phone": "number",\n      "arrayOfNumbers": "number[]",\n      "arrayOfStrings": "string[]"\n    }\n  },\n  "$resolvers": {\n    "findUser": {\n      "type": "user",\n      "resolve": {\n        "name": "Kristiyan Tachev",\n        "email": "test@gmail.com",\n        "phone": 414141,\n        "arrayOfNumbers": [515151, 412414],\n        "arrayOfStrings": ["515151", "412414"]\n      }\n    }\n  }\n}',{encoding:"utf-8"}):a.promisify(s.writeFile)("./gj.json",'\n{\n  "$mode": "basic",\n  "$resolvers": {\n    "findUser": {\n      "name": "Kristiyan Tachev",\n      "email": "test@gmail.com",\n      "phone": 414141,\n      "arrayOfNumbers": [515151, 412414],\n      "arrayOfStrings": ["515151", "412414"]\n    }\n  }\n}\n',{encoding:"utf-8"}):e.BootstrapFramework(r.AppModule,[n.CoreModule.forRoot({graphql:{openBrowser:o.nextOrDefault("--random",!0,e=>"true"!==e)},server:{randomPort:o.nextOrDefault("--random",!1),hapi:{port:o.nextOrDefault("--port",9e3,e=>Number(e))}}})]).subscribe(()=>console.log("Started"),console.log.bind(console));
},{"./app/app.module":"app/app.module.ts","./helpers/args-extractors":"helpers/args-extractors.ts"}]},{},["main.ts"], null)
//# sourceMappingURL=/main.js.map